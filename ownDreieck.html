<html>
<head>
<title>Bier</title>

<script type="text/javascript" src="utils/dojo.js"></script>
<script type="text/javascript" src="utils/xpath.js"></script>
<script type="text/javascript" src="utils/utils.js"></script>
<script type="text/javascript" src="utils/sort.js"></script>
<script type="text/javascript" src="utils/drawer.js"></script>
<script type="text/javascript" src="utils/events.js"></script>
<script type="text/javascript" src="components/texture.js"></script>
<script type="text/javascript" src="model/shaderModel.js"></script>
<script type="text/javascript" src="shaders.js"></script>
<script type="text/javascript" src="model/textureModel.js"></script>
<script type="text/javascript" src="model/objectModel.js"></script>
<script type="text/javascript" src="utils/sylvester.js"></script> 
<script type="text/javascript" src="utils/GlUtils.js"></script>
<script type="text/javascript" src="utils/shapeFactory.js"></script>  
<script type="text/javascript" src="mixins/TextFieldMixin.js"></script>  
<script type="text/javascript" src="mixins/UIMixin.js"></script>  
<script type="text/javascript" src="skeleton.js"></script>
<script type="text/javascript" src="lighting.js"></script>
<script type="text/javascript" src="components/object3D.js"></script>
<script type="text/javascript" src="components/texture.js"></script>
<script type="text/javascript" src="components/textUnit.js"></script>
<script type="text/javascript" src="components/scrollableTextUnit.js"></script>
<script type="text/javascript" src="components/staticScrollableTextUnit.js"></script>
<script type="text/javascript" src="components/label.js"></script>
<script type="text/javascript" src="components/button.js"></script>
<script type="text/javascript" src="components/window.js"></script>
<script type="text/javascript" src="components/tile.js"></script>
<script type="text/javascript" src="text/bmFont.js"></script>
<script type="text/javascript" src="animation.js"></script>
<script type="text/javascript" src="UIBase.js"></script> 




<script type="text/javascript">

conn = new Object();

function openConnection(){
  // uses global 'conn' object
  if (conn.readyState === undefined || conn.readyState > 1) {
    conn = new WebSocket('ws://9.152.99.132:5656');    
    conn.onopen = function () {
    
    };

    conn.onmessage = function (event) {
      var message = JSON.parse(event.data);
      if (typeof message == 'string') {
      		newFrag = new TextFragment(String.fromCharCode(13)+message, $V([0.0,1.0,0.0]));
      		//textUnit2.setText(textUnit2.text+String.fromCharCode(13)+message);
      		textUnit2.textFrags.push(newFrag);
      		textUnit2.setTextFrags(textUnit2.textFrags);
      		//textUnit2.label.animationMashs["message"].start();
      		myWindow.titleBar.animationMashs["windowFlip"].start();
      }
    };
    
    conn.onclose = function (event) {

    };
  }
	
}

function init() {
	
	openConnection();  
	
    object3d = new Array();
    
 	var myGl = WebGLBase.initGL(document.getElementById("scene"));
 	var myUI = new WebGLBase_UI(document.getElementById("scene"),document.getElementById("body"),myGl);
 	WebGLBase.UIDelegate = myUI;
 	
 	
    var myShaders = new Array();
    var myShaders2 = new Array();
    var myShaders3 = new Array();
    var myTextShader = new Array();  
    myRoot = new Object3D(myGl);
    var myRoot2 = new Object3D(myGl);
    myDrawer = new Drawer();
    var myDefs = new Array();
    var def = new DeferrableList();
    triangles = new Array();
    
	//instantiate a bitmapFont
	var newFont = new BitmapFontDescriptor();
	newFont.instantiate("arialLarge"); 
	console.log(newFont); 
   

	triangles[0] = createTriangle(new Point3D(0,  1,  0), new Point3D(-1, -1,  0), new Point3D(1, -1,  0));
	triangles[1] = createRectangle(new Point3D(-1,1,-1), new Point3D(1,1,-1), new Point3D(1,1,1), new Point3D(-1,1,1));
	triangles[2] = createRectangle(new Point3D(-1,1,-1), new Point3D(1,1,-1), new Point3D(1,-1,-1), new Point3D(-1,-1,-1));
	triangles[3] = createRectangle(new Point3D(1,1,1), new Point3D(1,-1,1), new Point3D(1,-1,-1), new Point3D(1,1,-1));
	triangles[4] = createRectangle(new Point3D(-1,1,1), new Point3D(-1,-1,1), new Point3D(-1,-1,-1), new Point3D(-1,1,-1));
	triangles[5] = createTriangle(new Point3D(-1,1,1), new Point3D(0,2,0), new Point3D(1,1,1));
	triangles[6] = createTriangle(new Point3D(-1,1,-1), new Point3D(0,2,0), new Point3D(1,1,-1));
    var object3d3 = WebGLBase.createObject3D(triangles, myGl);
    
    cube = new Array();
    cube[0] = createBoundingBox(new Point3D(-1,-1,-1), new Point3D(1,1,1));
    var object3dCube = WebGLBase.createObject3D(triangles, myGl);
    
    


	
	var myTexture = WebGLBase.textureModel.find("texpyra.jpg", myGl);
	var myTexture2 = WebGLBase.textureModel.find("grass.png", myGl);
	var myTexture3 = WebGLBase.textureModel.find("brown.jpg", myGl);
	var text_a = WebGLBase.textureModel.find("arialLargeTransparent.png", myGl);  
	var titleBarTexture = WebGLBase.textureModel.find("titleBar.png", myGl);
	var buttonTexture = WebGLBase.textureModel.find("button.png", myGl);
	upTexture = WebGLBase.textureModel.find("scrollUp.png", myGl);
	downTexture = WebGLBase.textureModel.find("scrollDown.png", myGl);
	flipTexture = WebGLBase.textureModel.find("flipButton.png", myGl);


    var triangle;
    var triangle2;
 
    myDefs[0] = WebGLBase.shaderPartFactory.createFromName("vertshader_benji").addCallback(function(data){myShaders[0] = data; });

    myDefs[1] = WebGLBase.shaderPartFactory.createFromName("fragshader_benji").addCallback(function(data){myShaders[1] = data; });
    myDefs[2] = WebGLBase.shaderPartFactory.createFromName("vertshader_benji").addCallback(function(data){myShaders2[0] = data; });
    myDefs[3] = WebGLBase.shaderPartFactory.createFromName2("dynamicColor", Shader.TYPE_FRAGMENT_SHADER).addCallback(function(data){myShaders2[1] = data; });
    myDefs[8] = WebGLBase.shaderPartFactory.createFromName("vertshader_texture").addCallback(function(data){myShaders3[0] = data; });
    myDefs.push( WebGLBase.shaderPartFactory.createFromName("vertshader_texture").addCallback(function(data){myTextShader[0] = data; }));
    myDefs.push( WebGLBase.shaderPartFactory.createFromName("textshader").addCallback(function(data){myTextShader[1] = data; }));
    myDefs[9] = WebGLBase.shaderPartFactory.createFromName("fragshader").addCallback(function(data){myShaders3[1] = data; });
    
    myDefs[4] = WebGLBase.objectModel.find("triangle3").addCallback(
                function(data){
                    //triangle = myRoot.add(WebGLBase.createObjectFromFile(data, myGl));
                    triangle = WebGLBase.createObjectFromFile(data, myGl);
                    triangle.add(object3dCube);
                    object3dCube.xOffset = -5;
                    object3dCube.yOffset = -5;
                    myRoot.add(object3d3);                    
                   
                                    
                    object3d3.yOffset = 4;
                    object3d3.xOffset = 10;
                    object3d3.zOffset = -40;

                    //var thirdChild = object3d3.add(WebGLBase.createObjectFromFile(data, myGl));
                    //thirdChild.xOffset = -30;
                    triangle.xOffset = 0;
                    triangle.zOffset = -40;
                    triangle.startRotation(2,"y");
                    //textUnit2.startRotation(1,"y");
                    triangle.onMyFirstEvent = function(event){
                    							var hitObject = hitTest(event.offsetX, event.offsetY, myRoot);
                                                //console.log(hitObject);    
                                                if (hitObject.clicked != null){ 
                                                	hitObject.clicked();           
                                                }                           
                                            };
                    triangle.onMoveRight = function(data){triangle.xOffset++;};
                    triangle.onMoveLeft = function(data){triangle.xOffset--;};
                    WebGLBase.event.register("a",triangle.onMyFirstEvent);
                    WebGLBase.event.register("moveRight",triangle.onMoveRight);
                    WebGLBase.event.register("moveLeft",triangle.onMoveLeft);
                });
    myDefs[5] = WebGLBase.objectModel.find("triangle2").addCallback(
                function(data){
                    triangle2 = triangle.add(WebGLBase.createObjectFromFile(data, myGl));
                    temp = data;
                    triangle2.xOffset = 3;
                    triangle2.zOffset = -2;
                   	triangle2.startRotation(2,"y");
                    triangle2.onMyFirstEvent = function(data){alert("im triangle2: "+data);};
                    var myEventID = WebGLBase.event.register("a",triangle2.onMyFirstEvent);
                    WebGLBase.event.unregister("a", myEventID);
                });
    myDefs[6] = WebGLBase.objectModel.find("pyramide").addCallback(
                function(data){
                    triangle3 = triangle2.add(WebGLBase.createObjectFromFile(data, myGl));
                   
                    triangle3.yOffset = 3;
                    triangle3.xOffset = 5;
                    triangle3.startRotation(2,"x");
                });
    myDefs[7] = WebGLBase.objectModel.find("pyramide").addCallback(
                function(data){
                    triangle4 = myRoot2.add(WebGLBase.createObjectFromFile(data, myGl));
                    triangle4.yOffset = 10;
                    triangle4.xOffset = 5;
                    triangle4.zOffset = -30;
                    triangle4.startRotation(2,"y");
                });
            
    				myDefs.push(AnimationMashFactory.createFlipAnimation("z",180,500));
				myDefs[myDefs.length-1].addCallback( function(data) {
					mash4 = data;
					mash4.name = "windowFlip";
				});
				
				myDefs.push(AnimationMashFactory.createCircleMaximizeAnimation(4,1500));
				myDefs[myDefs.length-1].addCallback( function(data) {
					mash5 = data;
					mash5.name = "message";
				});
    myDefs.push(WebGLBase.UIDelegate.init());
    
	flipAni = new RotationAnimation(Animation.TYPE_ONCE);
	flipAni.start_offset = Vector.create([0,0,0]);
	flipAni.end_offset = Vector.create([0,-90,0]);
	flipAni.duration = 500;
	myDefs.push(flipAni.completed);

    myDefs.push(WebGLBase.shaderPartFactory.createFromName2("lighting", Shader.TYPE_FRAGMENT_SHADER).addCallback(function(data){lightFrag = data; }));
myDefs.push(WebGLBase.shaderPartFactory.createFromName2("lighting", Shader.TYPE_VERTEX_SHADER).addCallback(function(data){vertFrag = data; }));
    
    def.finalCallback(function(){ 
    	
    	
    		var vertShader = ShaderBuilder.buildDefaultShader(Shader.TYPE_VERTEX_SHADER, myGl);
                var fragShader = ShaderBuilder.buildShaderFromParts(new Array(myShaders[1]), Shader.TYPE_FRAGMENT_SHADER, myGl);
                var vertShader2 = ShaderBuilder.buildShaderFromParts([], Shader.TYPE_VERTEX_SHADER, myGl);
                var fragShader2 = ShaderBuilder.buildShaderFromParts([myShaders2[1]], Shader.TYPE_FRAGMENT_SHADER, myGl);
                var vertShader3 = ShaderBuilder.buildShaderFromParts([myShaders3[0]], Shader.TYPE_VERTEX_SHADER, myGl);
                var fragShader3 = ShaderBuilder.buildShaderFromParts([myShaders3[1]], Shader.TYPE_FRAGMENT_SHADER, myGl);
                  
                var textShader_vert = ShaderBuilder.buildShaderFromParts([myTextShader[0]], Shader.TYPE_VERTEX_SHADER, myGl);   
                var textShader = ShaderBuilder.buildShaderFromParts([myTextShader[1]], Shader.TYPE_FRAGMENT_SHADER, myGl);    
                   
                //var myShaderProgram = ShaderProgramBuilder.buildShaderProgram(vertShader, fragShader);
                var myShaderProgram2 = ShaderProgramBuilder.buildShaderProgram(vertShader2, fragShader2);
                var myShaderProgram3 = ShaderProgramBuilder.buildShaderProgram(vertShader3, fragShader3);
                var myTextShaderP = ShaderProgramBuilder.buildShaderProgram(textShader_vert, textShader); 
    	
    	
    			WebGLBase.UIDelegate.ButtonShaderText = myTextShaderP; 
				WebGLBase.UIDelegate.ButtonShaderBack = myShaderProgram2;
				WebGLBase.UIDelegate.bmFontTexture = text_a;
				WebGLBase.UIDelegate.bmFontDescriptor = newFont;
				WebGLBase.textureShaderProgram = myShaderProgram3;
				
    	
    	    	textUnit = new ScrollableTextUnit(myGl, 12, 5); 
    			textUnit2 = new StaticScrollableTextUnit(myGl, 12, 8); 
    			myProfileName = new TextUnit(myGl,10,1);
    			myButton = new BarbieButton(myGl,2.35,1);
    			flipButton = new BarbieButton(myGl,1,1);
    			flipButton2 = new BarbieButton(myGl,1,1);
 			    flipButton3 = new BarbieButton(myGl,1,1);
 			    flipButton4 = new BarbieButton(myGl,1,1); 
 			    

    			myWindow = new GLWindow(myGl, 16,16);
    			myRightWindow = new GLWindow(myGl,16,16);
 		    	myLeftWindow = new GLWindow(myGl,16,16);

 			    myBackWindow = new GLWindow(myGl,16,16);
    			myProfileWindow = new GLWindow(myGl,12,8);
    			myWindow.parentDrag = true;

    			myWindow.titleBar.addAnimationMash(mash4);
    			
    			textUnit.backgroundField.name = "bg";
    			textUnit.setColor($V([0.3,0.3,0.3,1]));
    			textUnit2.setColor($V([0.3,0.3,0.3,1]));
    			object3d3.setColor($V([0,0,1,0.5]));
    			
   				myButton.setColor($V([0,1,0,0.5]));
   				myWindow.setColor($V([0.8,0.9,0.8,1]));
   				myBackWindow.setColor($V([0.8,0.9,0.8,1]));
   				myRightWindow.setColor($V([0.8,0.9,0.8,1]));
				myLeftWindow.setColor($V([0.8,0.9,0.8,1]));

  				myProfileWindow.setColor($V([0.8,0.9,0.8,1]));


    			
    			console.log(textUnit2);
    			
    			
    			flip = new AnimationMash();
    			flip.addStartAnimation(flipAni);
    			
    			
    			myWindowCube = new Object3D(myGl);
    			myWindowCube.name = "cube";
    			
    			myWindowCube.add(myWindow);
    			myWindowCube.add(myRightWindow);
    			myWindowCube.add(myBackWindow);
    			myWindowCube.add(myLeftWindow);

			var light = new PointLight($V([1,1,1]), $V([0,0,-10]));
			myRoot.addLight(light);
			myWindow.backgroundField.sheen = true;
			myWindow.backgroundField.shininess = 30;
			myWindow.backgroundField.sheenColor = Vector.create([1,1,1]);
			myWindow.titleBar.backgroundField.sheen = true;
			myWindow.titleBar.backgroundField.shininess = 30;
			myWindow.titleBar.backgroundField.sheenColor = Vector.create([1,1,1]);

			myRightWindow.backgroundField.sheen = true;
			myRightWindow.backgroundField.shininess = 30;
			myRightWindow.backgroundField.sheenColor = Vector.create([1,1,1]);
			myRightWindow.titleBar.backgroundField.sheen = true;
			myRightWindow.titleBar.backgroundField.shininess = 30;
			myRightWindow.titleBar.backgroundField.sheenColor = Vector.create([1,1,1]);

			myBackWindow.backgroundField.sheen = true;
			myBackWindow.backgroundField.shininess = 30;
			myBackWindow.backgroundField.sheenColor = Vector.create([1,1,1]);
			myBackWindow.titleBar.backgroundField.sheen = true;
			myBackWindow.titleBar.backgroundField.shininess = 30;
			myBackWindow.titleBar.backgroundField.sheenColor = Vector.create([1,1,1]);

			myLeftWindow.backgroundField.sheen = true;
			myLeftWindow.backgroundField.shininess = 30;
			myLeftWindow.backgroundField.sheenColor = Vector.create([1,1,1]);
			myLeftWindow.titleBar.backgroundField.sheen = true;
			myLeftWindow.titleBar.backgroundField.shininess = 30;
			myLeftWindow.titleBar.backgroundField.sheenColor = Vector.create([1,1,1]);

			myProfileWindow.backgroundField.sheen = true;
			myProfileWindow.backgroundField.shininess = 30;
			myProfileWindow.backgroundField.sheenColor = Vector.create([1,1,1]);
			myProfileWindow.titleBar.backgroundField.sheen = true;
			myProfileWindow.titleBar.backgroundField.shininess = 30;
			myProfileWindow.titleBar.backgroundField.sheenColor = Vector.create([1,1,1]);

    			
    			myRoot.add(myWindowCube);
    			myRoot.add(myProfileWindow);
    			myRoot.name = "root";
    			//myRoot.add(textUnit2);
    			
                myWindow.addSubview(textUnit);
                myWindow.addSubview(myButton);
                myWindow.addSubview(textUnit2);
                myWindow.addSubview(flipButton); 
                
                myRightWindow.addSubview(flipButton2);
                myBackWindow.addSubview(flipButton3);
                myLeftWindow.addSubview(flipButton4);


                
                myProfileWindow.addSubview(myProfileName);
    
     			textUnit.zOffset =0.1; 
                textUnit.xOffset = 0.5;
                textUnit.yOffset = -9.1;
                //textUnit.tileLayer = 1;    
				textUnit2.label.addAnimationMash(mash5);
                    
                //textUnit2.tileLayer = 1;    
                textUnit2.xOffset = 0.5;
                textUnit2.yOffset = -0.1;
                textUnit2.zOffset = 0.1;
                    
                myProfileName.tileLayer = 1;    
                myProfileName.xOffset = 0.1;
                myProfileName.yOffset = -0.1;
                myProfileName.zOffset = 0.1;
                myProfileName.textColor = $V([0,0,0]);
                
                myButton.zOffset = 0.1;
                myButton.xOffset = 0.5;
                myButton.yOffset = -14.5;
                myButton.tileLayer = 1;
                
                
                flipButton.zOffset = 0.1;
                flipButton.xOffset = 14.2;
                flipButton.yOffset = -0.1;
                flipButton.tileLayer = 1;
                
                flipButton2.zOffset = 0.1;
                flipButton2.xOffset = 14.2;
                flipButton2.yOffset = -0.1;
                flipButton2.tileLayer = 1;
                
                flipButton3.zOffset = 0.1;
                flipButton3.xOffset = 14.2;
                flipButton3.yOffset = -0.1;
                flipButton3.tileLayer = 1;
                   
                flipButton4.zOffset = 0.1;
                flipButton4.xOffset = 14.2;
                flipButton4.yOffset = -0.1;
                flipButton4.tileLayer = 1;
                      
                   
                   
                myWindowCube.zOffset = -37;
                myWindowCube.yOffset = 10;
				myWindowCube.xOffset = -13;
				                
				
				myRightWindow.zOffset = 8;
                myRightWindow.yOffset = 0;
				myRightWindow.xOffset = 8;
				
				myWindow.zOffset = 8;
                myWindow.yOffset = 0;
				myWindow.xOffset = -8;
				
				myBackWindow.zOffset = -8;
                myBackWindow.yOffset = 0;
				myBackWindow.xOffset = 8;
				
				myLeftWindow.zOffset = -8;
                myLeftWindow.yOffset = 0;
				myLeftWindow.xOffset = -8;
				
				myRightWindow.rotation = true;
				myRightWindow.rotationAxis = "y";
				myRightWindow.rotValue = 90;
				myRightWindow.parentDrag = true;
				
				myBackWindow.rotation = true;
				myBackWindow.rotationAxis = "y";
				myBackWindow.rotValue = 180;
				myBackWindow.parentDrag = true;
				
				myLeftWindow.rotation = true;
				myLeftWindow.rotationAxis = "y";
				myLeftWindow.rotValue = 270;
				myLeftWindow.parentDrag = true;
				
				myProfileWindow.zOffset = -28;
                myProfileWindow.yOffset = 10;
				myProfileWindow.xOffset = 5;
				

				myWindow.name = "window";
				
				myWindow.titleBar.setTextFrags([new TextFragment("Chat Window",$V([1,1,1]))]);
				myRightWindow.titleBar.setText("Info");
				myProfileWindow.titleBar.setText("Profile");
				myBackWindow.titleBar.setText("back");
				myLeftWindow.titleBar.setText("left");
				

				
				//myWindow.startRotation(1,"y");
				//textUnit2.startRotation(1,"y");
				
                //TODO default setting for shaderPrograms   
                myRoot.setShaderProgram(myShaderProgram2);
                triangle.setShaderProgram(myShaderProgram2);
                triangle2.setShaderProgram(myShaderProgram3);
                triangle3.setShaderProgram(myShaderProgram3);
                triangle4.setShaderProgram(myShaderProgram2);
                object3dCube.setShaderProgram(myShaderProgram2);
                object3d3.setShaderProgram(myShaderProgram2);
                myWindowCube.addAnimationMash(flip);
                myWindowCube.setShaderProgram(myShaderProgram2);
                

		
				textUnit.setShaderProgram(myTextShaderP);
				textUnit.name = "textUnit";
				textUnit.backgroundField.setShaderProgram(myShaderProgram2);

				textUnit.setBitmapFont(text_a,newFont);
				textUnit.setFontSize(-45);
				textUnit.setText("AB");
				
				textUnit2.setShaderProgram(myTextShaderP);
				textUnit2.name = "textUnit2";
				textUnit2.backgroundField.setShaderProgram(myShaderProgram2);
				
				textUnit2.setBitmapFont(text_a,newFont);
				textUnit2.setFontSize(-45);
				textUnit2.setTextFrags([new TextFragment("chat opened...",$V([1,0,0]))]);
				
				
				myProfileName.setShaderProgram(myTextShaderP);
				myProfileName.name = "textUnit2";
				myProfileName.backgroundField.setShaderProgram(myShaderProgram2);
			

				
				myProfileName.setBitmapFont(text_a,newFont); 
				myProfileName.setFontSize(-20);
				myProfileName.setText("Benjamin");
				myProfileName.backgroundField.visible = false; 
				//myProfileName.backgroundField.setColor ($V([1,1,1,1]));
				myProfileName.cursor.setColor ($V([0,0,0,1]));
				
				
			
				myButton.setShaderProgram(WebGLBase.UIDelegate.ButtonShaderText);
				myButton.name = "Button";				
				myButton.setBitmapFont(WebGLBase.UIDelegate.bmFontTexture,WebGLBase.UIDelegate.bmFontDescriptor);
				myButton.setFontSize(-20);
				myButton.setText("Send"); 
				myButton.clicked = function(){if (conn.readyState === 1) {
													var name =  myProfileName.text+": ";
													var message = textUnit.text;
													conn.send(JSON.stringify(message)); 
      												//textUnit2.setText(textUnit2.text+String.fromCharCode(13)+message);
      												textUnit2.textFrags.push(new TextFragment(String.fromCharCode(13)+name, $V([0.0,0.0,1.0])));
     											    textUnit2.textFrags.push(new TextFragment(message, $V([1.0,1.0,1.0])));
      												textUnit2.setTextFrags(textUnit2.textFrags)};
      												      		//newFrag = new TextFragment(String.fromCharCode(13)+message, $V([1.0,1.0,1.0]));
      		//textUnit2.setText(textUnit2.text+String.fromCharCode(13)+message);
      		//textUnit2.addTextFragment(newFrag)};
      		//textUnit2.label.animationMashs["message"
												textUnit.setText("");}
												
				flipButton.setShaderProgram(WebGLBase.UIDelegate.ButtonShaderText);
				flipButton.name = "flipButton";				
				flipButton.setBitmapFont(WebGLBase.UIDelegate.bmFontTexture,WebGLBase.UIDelegate.bmFontDescriptor);
				flipButton.setFontSize(-20);
				flipButton.setText(""); 
				flipButton.clicked = function(){ 
					flip.start(); 
					flip.pause(); 
				}
				
				flipButton2.setShaderProgram(WebGLBase.UIDelegate.ButtonShaderText);
				flipButton2.name = "flipButton";				
				flipButton2.setBitmapFont(WebGLBase.UIDelegate.bmFontTexture,WebGLBase.UIDelegate.bmFontDescriptor);
				flipButton2.setFontSize(-20);
				flipButton2.setText(""); 
				flipButton2.clicked = function(){ 
					flip.start(); 
					flip.pause(); 
				}
				
				flipButton3.setShaderProgram(WebGLBase.UIDelegate.ButtonShaderText);
				flipButton3.name = "flipButton";				
				flipButton3.setBitmapFont(WebGLBase.UIDelegate.bmFontTexture,WebGLBase.UIDelegate.bmFontDescriptor);
				flipButton3.setFontSize(-20);
				flipButton3.setText(""); 
				flipButton3.clicked = function(){ 
					flip.start(); 
					flip.pause(); 
				}
				
				flipButton4.setShaderProgram(WebGLBase.UIDelegate.ButtonShaderText);
				flipButton4.name = "flipButton";				
				flipButton4.setBitmapFont(WebGLBase.UIDelegate.bmFontTexture,WebGLBase.UIDelegate.bmFontDescriptor);
				flipButton4.setFontSize(-20);
				flipButton4.setText(""); 
				flipButton4.clicked = function(){ 
					flip.start(); 
					flip.pause(); 
				}
				
			
				//textUnit2.cursor.addAnimationMash(myMash2);
				
				//myMash.start();
				//console.log(myTextShaderP.fragmentShader.parts[0].getParameterById("marked"));
				myTextShaderP.setParameter(myTextShaderP.fragmentShader.parts[0].getParameterById("marked"), true);
				
				//textUnit.children[0].setShaderProgram(myShaderProgram3);
				//textUnit.children[1].setShaderProgram(myShaderProgram3);

                
                triangle3.addTexture(myTexture, "randomTextureCoord", "uSampler" ,myGl);
                triangle2.addTexture(myTexture2, "randomTextureCoord", "uSampler" ,myGl);
                myWindow.titleBar.backgroundField.addTexture(titleBarTexture, "randomTextureCoord", "uSampler" ,myGl);
                myBackWindow.titleBar.backgroundField.addTexture(titleBarTexture, "randomTextureCoord", "uSampler" ,myGl);
                myLeftWindow.titleBar.backgroundField.addTexture(titleBarTexture, "randomTextureCoord", "uSampler" ,myGl);

                

                myRightWindow.titleBar.backgroundField.addTexture(titleBarTexture, "randomTextureCoord", "uSampler" ,myGl);

                myProfileWindow.titleBar.backgroundField.addTexture(titleBarTexture, "randomTextureCoord", "uSampler" ,myGl);
                myButton.backgroundField.setShaderProgram(WebGLBase.textureShaderProgram);
                myButton.backgroundField.addTexture(buttonTexture, "randomTextureCoord", "uSampler" ,myGl); 
                flipButton.backgroundField.setShaderProgram(WebGLBase.textureShaderProgram);
                flipButton.backgroundField.addTexture(flipTexture, "randomTextureCoord", "uSampler" ,myGl); 
                flipButton2.backgroundField.setShaderProgram(WebGLBase.textureShaderProgram);
                flipButton2.backgroundField.addTexture(flipTexture, "randomTextureCoord", "uSampler" ,myGl); 
                flipButton3.backgroundField.setShaderProgram(WebGLBase.textureShaderProgram);
                flipButton3.backgroundField.addTexture(flipTexture, "randomTextureCoord", "uSampler" ,myGl); 
                flipButton4.backgroundField.setShaderProgram(WebGLBase.textureShaderProgram);
                flipButton4.backgroundField.addTexture(flipTexture, "randomTextureCoord", "uSampler" ,myGl);               
                //textUnit.children[0].addTexture(text_a, "randomTextureCoord", "uSampler" ,myGl);
                //textUnit.children[1].addTexture(text_a, "randomTextureCoord", "uSampler" ,myGl); 

				

                /*Here RootNode is declared as Node to start drawing.
                Beginning here, all children of the Node will be drawn.                
                */
               console.log(myWindow);
               myDrawer.startDrawing(myRoot);  
    });  
    
    def.addDeferrables(myDefs);

}

</script>
</head>
<body id="body" onload="init()">
<canvas id="scene" width=1400 height=650></canvas>

</body>
</html>
