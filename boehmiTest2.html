<html>
<head>
<title>Bier</title>
<script type="text/javascript" src="utils/utils.js"></script>
<script type="text/javascript" src="utils/sort.js"></script>
<script type="text/javascript" src="utils/drawer.js"></script>
<script type="text/javascript" src="utils/events.js"></script>
<script type="text/javascript" src="components/texture.js"></script>
<script type="text/javascript" src="model/shaderModel.js"></script>
<script type="text/javascript" src="shaders.js"></script>

<script type="text/javascript" src="model/textureModel.js"></script>
<script type="text/javascript" src="model/objectModel.js"></script>
<script type="text/javascript" src="utils/sylvester.js"></script> 
<script type="text/javascript" src="utils/GlUtils.js"></script> 
<script type="text/javascript" src="skeleton.js"></script>
<script type="text/javascript" src="animation.js"></script>
<script type="text/javascript" src="components/object3D.js"></script>
<script type="text/javascript" src="components/texture.js"></script>

<script type="text/javascript">
var triangle;
function init() {
 	var myGl = WebGLBase.initGL(document.getElementById("scene"));
    var myRoot = new Object3D(myGl);
    myDrawer = new Drawer();
    var myDefs = new Array();
    var def = new DeferrableList();

	//var myTexture = WebGLBase.textureModel.find("texpyra.jpg", myGl);
	//var myTexture2 = WebGLBase.textureModel.find("grass.png", myGl);
	//var myTexture3 = WebGLBase.textureModel.find("brown.jpg", myGl);
    
    myDefs.push(WebGLBase.objectModel.find("triangle3").addCallback(
                function(data){
                    triangle = myRoot.add(WebGLBase.createObjectFromFile(data, myGl));
                    triangle.zOffset = -40;
                }));

	rotani3 = new TranslationAnimation(Animation.TYPE_ONCE);
	myDefs.push(rotani3.completed);	
	rotani4 = new TranslationAnimation(Animation.TYPE_ONCE);
	myDefs.push(rotani4.completed);	
	
	mash = new AnimationMash();
		
    def.finalCallback(function(){ 

				var vertShader = ShaderBuilder.buildDefaultShader(Shader.TYPE_VERTEX_SHADER, myGl);
                var fragShader = ShaderBuilder.buildDefaultShader(Shader.TYPE_FRAGMENT_SHADER, myGl);
                   
                var myShaderProgram = ShaderProgramBuilder.buildShaderProgram(vertShader, fragShader);

                   
                myRoot.setShaderProgram(myShaderProgram);
                myRoot.name = "root";
                triangle.setShaderProgram(myShaderProgram);
                triangle.name = "triangle";
              
				
				//triangle.addAnimation(mash);
				
				/*
                triangle.addTexture(myTexture, "randomTextureCoord", "uSampler");
                triangle.addTexture(myTexture2, "randomTextureCoord", "uSampler");
                triangle.addTexture(myTexture3, "randomTextureCoord", "uSampler");
				*/
				
                /*Here RootNode is declared as Node to start drawing.
                Beginning here, all children of the Node will be drawn.                
                */
                myDrawer.startDrawing(myRoot);  
                console.log("haha");
    });  
    def.addDeferrables(myDefs);

}

function startAnimation() {
	mash.start();
}
function pauseAnimation() {
	mash.pause();
}
function resumeAnimation() {
	mash.resume();
}
function stopAnimation() {
	mash.stopAnimations();
}


</script>
</head>
<body onload="init()"><span>
<canvas id="scene"  width=512 height=512></canvas>
</span>
<span id="fps" width=100></span>
<button name="Klickmich" type="button"
      value="Überraschung" onclick='WebGLBase.event.eventOccured("moveLeft","blabla");'>
      <p>
        <b>Root nach links</b>
      </p>
 </button>
<button name="Klickmich" type="button"
      value="Überraschung" onclick='WebGLBase.event.eventOccured("moveRight","blabla");'>
      <p>
        <b>Root nach rechts</b>
      </p>
 </button>
 <br>
 <button onClick="startAnimation()">Start</button>
 <button onClick="pauseAnimation()">Pause</button>
 <button onClick="resumeAnimation()">Resume</button>
 <button onClick="stopAnimation()">Stop</button>
</body>
</html>
